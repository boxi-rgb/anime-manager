# Implementation Plan: Google Drive Persistence

**Track ID:** google-drive-persistence_20260220
**Spec:** [spec.md](./spec.md)
**Created:** 2026-02-20
**Status:** [/] In Progress

## Overview
既存の Vanilla JS アプリケーションに Google Identity Services と Drive API を統合します。データの変更を検知してバックグラウンドで自動保存する仕組みを構築します。

## Phase 1: Foundation & Auth
認証基盤の構築。

### Tasks
- [x] Task 1.1: Google SDK (gapi, gis) の読み込み処理を `index.html` に追加
- [x] Task 1.2: OAuth クライアント ID を環境に合わせてロードする設定機能の実装
- [x] Task 1.3: ログイン・ログアウトボタンの UI 実装と、アクセストークン取得フローの構築

### Verification
- [x] 認証ボタンから Google ログイン画面が開き、トークンが取得できること。

## Phase 2: Drive API Integration
データの保存と読み込み。

### Tasks
- [x] Task 2.1: Drive 上の特定のファイル名 (`anime_data.json`) を検索・作成するユーティリティの実装
- [x] Task 2.2: 現在の視聴リストを JSON 形式で Drive へ書き込む機能の実装
- [x] Task 2.3: アプリ起動時に Drive からデータをダウンロードし、LocalStorage を初期化する機能の実装

### Verification
- [x] ログインした状態で、Drive 上に `anime_data.json` が自動作成/更新されること。

## Phase 3: Automatic Sync & Restoration
自動化と堅牢性の向上。

### Tasks
- [x] Task 3.1: 視聴状態の変更（追加、削除、チェック入れ等）を検知して Drive 保存をトリガーするフックの実装
- [x] Task 3.2: ブラウザの掃除をシミュレートした復旧挙動のテストと調整
- [x] Task 3.3: ログイン状態に応じた UI/UX の洗練（保存中インジケータ等）

### Verification
- [x] **復旧テスト**: LocalStorage 削除後、再ログインでデータが完全に戻ること。
- [x] 編集後、即座にクラウド側に反映されていること。

## Final Verification
- [x] 全ての受入条件を満たしている。
- [x] コンソールエラーやメモリリークがない。
- [x] README の更新（環境設定方法など）。

---

_Generated by Conductor. Tasks will be marked [~] in progress and [x] complete._
